---
import BaseLayout from '../layouts/BaseLayout.astro'
import SidePanel from '../components/SidePanel.astro'
import MapPanel from '../components/MapPanel.astro'
---

<BaseLayout>
	<section class="main-layout" style="height: calc(100dvh - 52px)">
		<div class="columns is-gapless" style="height: 100%; align-items: stretch">

			<!-- SIDE PANEL -->
			<aside class="column is-narrow side-panel isopen">
				<div class="side-panel-content isopen">
					<SidePanel />
				</div>
			</aside>

			<!-- MAP COLUMN -->
			<div class="column map-column">
				<button id="toggleSidePanel" class="side-panel-open-button">☰</button>

				<div class="map-grid">
					<div class="map-grid-map">
						<MapPanel />

						<!-- bottom toggle lives inside map -->
						<button id="toggleBottomPanel" class="bottom-panel-toggle">▼</button>
					</div>

					<!-- BOTTOM PANEL -->
					<div class="bottom-panel isopen">
						<div class="bottom-panel-content">
							HEY
						</div>
					</div>
				</div>
			</div>

		</div>
	</section>
</BaseLayout>

<style>
	/* ----------------------------------------------------------
		SIDE PANEL
	---------------------------------------------------------- */

	.side-panel {
		flex: none !important;
		display: block !important;
		overflow: hidden;
	}

	.map-column {
		position: relative;
	}

	/* desktop slide */
	@media (min-width: 769px) {
		.side-panel {
			width: 20rem;
			margin-left: 0 !important;
			transition: margin-left .3s ease;
		}

		.side-panel.isopen {
			margin-left: 0 !important;
		}

		.side-panel:not(.isopen) {
			margin-left: -20rem !important;
		}

		.side-panel-content {
			height: 100vh;
			overflow-y: auto;
		}
	}

	/* mobile accordion */
	@media (max-width: 768px) {
		.side-panel {
			width: 100%;
			height: auto !important;
			flex: none !important;
			overflow: hidden;
		}

		.side-panel-content {
			max-height: 80vh;
			overflow-y: auto;
			transition: max-height .3s ease;
		}

		.side-panel-content:not(.isopen) {
			max-height: 0;
			overflow: hidden;
		}

		.map-column {
			display: flex;
			flex-direction: column;
			height: 100%;
		}

		.map-grid {
			flex: 1 1 auto;
			min-height: 0;
		}
	}

	/* ----------------------------------------------------------
		BOTTOM PANEL (container animates)
	---------------------------------------------------------- */

	.map-grid {
		display: grid;
		height: 100%;
		grid-template-rows: 1fr auto;
	}

	.bottom-panel {
		background: #f5f5f5;
		overflow: hidden;
		height: 10rem;
		max-height: 10rem;
		transition: max-height .3s ease;
	}

	.bottom-panel:not(.isopen) {
		max-height: 0;
	}

	.bottom-panel-content {
		height: 100%;
		overflow-y: auto;
	}

	.bottom-panel-toggle {
		position: absolute;
		bottom: .5rem;
		right: 1rem;
		z-index: 2000;
		background: #333;
		color: white;
		border: none;
		padding: .25rem .5rem;
		cursor: pointer;
		border-radius: 4px;
		font-size: .8rem;
	}

	/* ----------------------------------------------------------
		MAP GRID MAP
	---------------------------------------------------------- */

	.map-grid-map {
		position: relative;
		min-height: 0;
	}

	/* ----------------------------------------------------------
		SIDE PANEL TOGGLE BUTTON
	---------------------------------------------------------- */

	.side-panel-open-button {
		position: absolute;
		top: .5rem;
		left: .5rem;
		z-index: 2000;
		background: #333;
		color: white;
		border: none;
		padding: .25rem .5rem;
		cursor: pointer;
		border-radius: 4px;
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const sidePanel = document.querySelector('.side-panel')
		const sidePanelContent = document.querySelector('.side-panel-content')
		const toggleSide = document.getElementById('toggleSidePanel')

		const bottomPanel = document.querySelector('.bottom-panel')
		const toggleBottom = document.getElementById('toggleBottomPanel')

		toggleSide?.addEventListener('click', () => {
			sidePanel.classList.toggle('isopen')
			sidePanelContent.classList.toggle('isopen')
		})

		toggleBottom?.addEventListener('click', () => {
			bottomPanel.classList.toggle('isopen')
			const isOpen = bottomPanel.classList.contains('isopen')
			toggleBottom.textContent = isOpen ? '▼' : '▲'
		})
	})
</script>
