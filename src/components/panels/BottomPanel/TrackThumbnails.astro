---
import Thumbnail from './Thumbnail.astro';
---

<template
    x-for="(p, i) in photos"
    :key="$store.tracks.active + '-' + i"
    x-data="trackThumbnails()"
>
    <Thumbnail
        item="p"
        index="i"
        getImage="getImage"
        getLabel="getLabel"
        onClick="onClick"
    />
</template>

<script is:inline>
    function trackThumbnails() {
        return {
            get photos() {
                return this.$store.tracks.items[this.$store.tracks.active]
                    ?.geotags?.geoTags?.trackPhotos ?? []
            },

            getImage(p) {
                return p?.picThumbBlob
                    ? `data:image/jpeg;base64,${p.picThumbBlob}`
                    : ''
            },

            getLabel(p, i) {
                return p?.picCaption || `Photo ${i}`
            },

            onClick(p, i) {
				console.log('open carousel')
                this.$store.carousel.open(this.photos, i)
            }
        }
    }
</script>
