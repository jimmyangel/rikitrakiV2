---
import '../../../styles/map.css' 
import LayerControl from './LayerControl.astro'
import ZoomControl from './ZoomControl.astro'
import { Icon } from 'astro-icon/components'
import MapPopup from './MapPopup.astro'
import LookDownControl from './LookDownControl.astro'
import NorthArrowControl from './NorthArrowControl.astro'
---
<div id="mapRoot" style="position: relative;">

    <div class="map-loading-overlay" x-data x-show="$store.tracks.loading" x-cloak>
        <div class="map-loading-spinner"></div>
    </div>

    <!-- Cesium canvas -->
    <div id="cesiumContainer"></div>

    <!-- HTML layer for geotagged thumbnails -->
    <div id="map-thumbnails-layer"></div>

    <MapPopup />

    <div class="map-top map-right">
        <NorthArrowControl />
        <ZoomControl />
        <LookDownControl />
        <LayerControl />
    </div>
</div>

<style>
    #mapRoot {
        position: relative;
        height: 100%;
        font-family: sans-serif;
    }

    #cesiumContainer {
        position: absolute;
        inset: 0;
    }

    /* Layer for map thumbnails */
    #map-thumbnails-layer {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: var(--z-map-thumbnails);
    }

    .attribution-box {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0,0,0,0.35);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        color: #fff;
        z-index: 9999;
        pointer-events: auto;
    }

    .map-loading-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        z-index: 500;
    }

    .map-loading-spinner {
        width: 36px;
        height: 36px;
        border: 4px solid rgba(0,0,0,0.2);
        border-top-color: rgba(0,0,0,0.6);
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>
